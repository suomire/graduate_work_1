[2023-11-03T13:34:54.718+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:33:46.183444+00:00 [queued]>
[2023-11-03T13:34:54.725+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:33:46.183444+00:00 [queued]>
[2023-11-03T13:34:54.726+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:34:54.747+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:33:46.183444+00:00
[2023-11-03T13:34:54.755+0000] {standard_task_runner.py:57} INFO - Started process 3117 to run task
[2023-11-03T13:34:54.758+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:33:46.183444+00:00', '--job-id', '136', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmp208pambv']
[2023-11-03T13:34:54.761+0000] {standard_task_runner.py:85} INFO - Job 136: Subtask write_to_es
[2023-11-03T13:34:54.926+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:33:46.183444+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:34:55.185+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:33:46.183444+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:33:46.183444+00:00'
[2023-11-03T13:34:55.235+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='47050db6-580f-493c-a007-a11c8768ce1b', title='Star Trek: Enterprise', type='movie', rating=7.5, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Drama, Sci-Fi', actors_names=['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], actors_ids=['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], writers_names=['Rick Berman', 'Brannon Braga'], writers_ids=['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], directors_names=[], directors_ids=[], description="The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."), FilmWorkES(id='496f504e-20fa-4dfd-b4cb-c7c4ef636e07', title='Rock Star', type='movie', rating=6.3, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223658, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223674, tzinfo=TzInfo(UTC)), genre='Drama, Music', actors_names=['Mark Wahlberg', 'Jennifer Aniston', 'Jason Bonham', 'Dominic West'], actors_ids=['25423597-4cb0-4e9f-a9aa-86b1fd3aadee', '9ea3f318-841d-44fc-afba-21d154eb99be', 'b2362da9-6c24-422c-8085-01851ba79297', 'fc616cc0-3961-44ff-ac27-9bfdcc28917f'], writers_names=['John Stockwell'], writers_ids=['8c0eb98b-4020-4012-914e-533939ddafde'], directors_names=['Stephen Herek'], directors_ids=['eda15243-9373-412b-8010-1cc70cacebf5'], description="Chris Cole was born to rock. His longtime girlfriend Emily believes his talent could take him all the way - but Chris worships at the altar of Bobby Beers, the fiery frontman for heavy metal legends Steel Dragon. By day, Chris still lives at home with his parents and spends his days repairing copy machines. But when Chris takes the stage, fronting Pennsylvania's premiere Steel Dragon tribute band, all of that disappears. Chris Cole is Bobby Beers - mesmerizing audiences with his perfect imitation of Beers' electrifying vocals. The night his bandmates boot him out of the group, Chris is devastated - until an unexpected phone call changes his life forever: He, Chris Cole, has been tapped to replace Bobby Beers as the lead singer of Steel Dragon. In an instant, Chris rockets to the dizzying heights of sudden stardom, rising from devotee to icon, from rock fan to rock god - the wanna-be who got to be. So what happens when an average guy gets everything he wants - and discovers it's not enough?")]
[2023-11-03T13:34:55.235+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:34:55.236+0000] {movie_pg_es.py:122} INFO - movies
[2023-11-03T13:34:55.236+0000] {movie_pg_es.py:123} INFO - 47050db6-580f-493c-a007-a11c8768ce1b
[2023-11-03T13:34:55.237+0000] {movie_pg_es.py:127} INFO - 
[2023-11-03T13:34:55.237+0000] {movie_pg_es.py:133} INFO - {'_index': 'movies', '_id': '47050db6-580f-493c-a007-a11c8768ce1b', '_source': {'id': '47050db6-580f-493c-a007-a11c8768ce1b', 'title': 'Star Trek: Enterprise', 'type': 'movie', 'rating': 7.5, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], 'actors_ids': ['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], 'writers_names': ['Rick Berman', 'Brannon Braga'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], 'directors_names': [], 'directors_ids': [], 'description': "The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."}}
[2023-11-03T13:34:55.237+0000] {movie_pg_es.py:122} INFO - movies
[2023-11-03T13:34:55.238+0000] {movie_pg_es.py:123} INFO - 496f504e-20fa-4dfd-b4cb-c7c4ef636e07
[2023-11-03T13:34:55.238+0000] {movie_pg_es.py:127} INFO - 
[2023-11-03T13:34:55.238+0000] {movie_pg_es.py:133} INFO - {'_index': 'movies', '_id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', '_source': {'id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', 'title': 'Rock Star', 'type': 'movie', 'rating': 6.3, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223658, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223674, tzinfo=TzInfo(UTC)), 'genre': 'Drama, Music', 'actors_names': ['Mark Wahlberg', 'Jennifer Aniston', 'Jason Bonham', 'Dominic West'], 'actors_ids': ['25423597-4cb0-4e9f-a9aa-86b1fd3aadee', '9ea3f318-841d-44fc-afba-21d154eb99be', 'b2362da9-6c24-422c-8085-01851ba79297', 'fc616cc0-3961-44ff-ac27-9bfdcc28917f'], 'writers_names': ['John Stockwell'], 'writers_ids': ['8c0eb98b-4020-4012-914e-533939ddafde'], 'directors_names': ['Stephen Herek'], 'directors_ids': ['eda15243-9373-412b-8010-1cc70cacebf5'], 'description': "Chris Cole was born to rock. His longtime girlfriend Emily believes his talent could take him all the way - but Chris worships at the altar of Bobby Beers, the fiery frontman for heavy metal legends Steel Dragon. By day, Chris still lives at home with his parents and spends his days repairing copy machines. But when Chris takes the stage, fronting Pennsylvania's premiere Steel Dragon tribute band, all of that disappears. Chris Cole is Bobby Beers - mesmerizing audiences with his perfect imitation of Beers' electrifying vocals. The night his bandmates boot him out of the group, Chris is devastated - until an unexpected phone call changes his life forever: He, Chris Cole, has been tapped to replace Bobby Beers as the lead singer of Steel Dragon. In an instant, Chris rockets to the dizzying heights of sudden stardom, rising from devotee to icon, from rock fan to rock god - the wanna-be who got to be. So what happens when an average guy gets everything he wants - and discovers it's not enough?"}}
[2023-11-03T13:34:55.239+0000] {movie_pg_es.py:142} INFO - [{'_index': 'movies', '_id': '47050db6-580f-493c-a007-a11c8768ce1b', '_source': {'id': '47050db6-580f-493c-a007-a11c8768ce1b', 'title': 'Star Trek: Enterprise', 'type': 'movie', 'rating': 7.5, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], 'actors_ids': ['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], 'writers_names': ['Rick Berman', 'Brannon Braga'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], 'directors_names': [], 'directors_ids': [], 'description': "The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."}}, {'_index': 'movies', '_id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', '_source': {'id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', 'title': 'Rock Star', 'type': 'movie', 'rating': 6.3, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223658, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223674, tzinfo=TzInfo(UTC)), 'genre': 'Drama, Music', 'actors_names': ['Mark Wahlberg', 'Jennifer Aniston', 'Jason Bonham', 'Dominic West'], 'actors_ids': ['25423597-4cb0-4e9f-a9aa-86b1fd3aadee', '9ea3f318-841d-44fc-afba-21d154eb99be', 'b2362da9-6c24-422c-8085-01851ba79297', 'fc616cc0-3961-44ff-ac27-9bfdcc28917f'], 'writers_names': ['John Stockwell'], 'writers_ids': ['8c0eb98b-4020-4012-914e-533939ddafde'], 'directors_names': ['Stephen Herek'], 'directors_ids': ['eda15243-9373-412b-8010-1cc70cacebf5'], 'description': "Chris Cole was born to rock. His longtime girlfriend Emily believes his talent could take him all the way - but Chris worships at the altar of Bobby Beers, the fiery frontman for heavy metal legends Steel Dragon. By day, Chris still lives at home with his parents and spends his days repairing copy machines. But when Chris takes the stage, fronting Pennsylvania's premiere Steel Dragon tribute band, all of that disappears. Chris Cole is Bobby Beers - mesmerizing audiences with his perfect imitation of Beers' electrifying vocals. The night his bandmates boot him out of the group, Chris is devastated - until an unexpected phone call changes his life forever: He, Chris Cole, has been tapped to replace Bobby Beers as the lead singer of Steel Dragon. In an instant, Chris rockets to the dizzying heights of sudden stardom, rising from devotee to icon, from rock fan to rock god - the wanna-be who got to be. So what happens when an average guy gets everything he wants - and discovers it's not enough?"}}]
[2023-11-03T13:34:55.248+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:200 duration:0.008s]
[2023-11-03T13:34:55.249+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 143, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 274, in _process_bulk_chunk_success
    raise BulkIndexError(f"{len(errors)} document(s) failed to index.", errors)
elasticsearch.helpers.BulkIndexError: 2 document(s) failed to index.
[2023-11-03T13:34:55.296+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T133346, start_date=20231103T133454, end_date=20231103T133455
[2023-11-03T13:34:55.312+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 136 for task write_to_es (2 document(s) failed to index.; 3117)
[2023-11-03T13:34:55.331+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:34:55.397+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
