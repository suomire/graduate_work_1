[2023-11-03T13:37:56.935+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:36:46.183444+00:00 [queued]>
[2023-11-03T13:37:56.944+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:36:46.183444+00:00 [queued]>
[2023-11-03T13:37:56.944+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:37:56.965+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:36:46.183444+00:00
[2023-11-03T13:37:56.973+0000] {standard_task_runner.py:57} INFO - Started process 3192 to run task
[2023-11-03T13:37:56.976+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:36:46.183444+00:00', '--job-id', '145', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmpwtjyu88t']
[2023-11-03T13:37:56.979+0000] {standard_task_runner.py:85} INFO - Job 145: Subtask write_to_es
[2023-11-03T13:37:57.155+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:36:46.183444+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:37:57.397+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:36:46.183444+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:36:46.183444+00:00'
[2023-11-03T13:37:57.451+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='a9d52337-3249-49ae-92b8-65ee9ebaf359', title='Star Wars Rebels', type='movie', rating=8.0, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223819, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223835, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Animation, Family, Fantasy, Mystery, Sci-Fi', actors_names=['Taylor Gray', 'Dave Filoni', 'Freddie Prinze Jr.', 'Vanessa Marshall'], actors_ids=['11819966-b9d1-494d-bafa-9033ddbe3ab4', '32f131ef-cd32-4659-a037-bcff3f12ac0c', '57a4f809-225e-4a8a-a867-0537a085d6c4', '8026ef16-24cf-43a3-be5b-20609a5265ba'], writers_names=['Dave Filoni', 'Carrie Beck', 'Simon Kinberg'], writers_ids=['32f131ef-cd32-4659-a037-bcff3f12ac0c', '6ba834a0-1039-4b5c-ab78-d5f1f18a4e7d', 'a6d0f7e6-450c-4a16-8b9f-1a6d9a1ce837'], directors_names=[], directors_ids=[], description='An animated TV series set between the events of Episode III and IV, Star Wars Rebels takes place in a time where the Empire is securing its grip on the galaxy and hunting down the last of the Jedi Knights as a fledgling rebellion against the Empire is taking shape.'), FilmWorkES(id='bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', title='Lone Star', type='movie', rating=7.4, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223760, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223776, tzinfo=TzInfo(UTC)), genre='Drama, Mystery', actors_names=['Stephen J. Lang', 'Chris Cooper', 'Stephen Mendillo', 'Elizabeth Peña'], actors_ids=['4017cda3-0934-41b1-b8e9-0e3fb792d2ce', '9412ef02-5ed1-407b-9420-ead779a4990a', 'b6cbdda5-049b-4cfe-b393-fdca28688022', 'c7d49113-c202-45a8-a267-a8cd61f27543'], writers_names=['John Sayles'], writers_ids=['0031feab-8f53-412a-8f53-47098a60ac73'], directors_names=['John Sayles'], directors_ids=['0031feab-8f53-412a-8f53-47098a60ac73'], description="John Sayles' murder-mystery explores interpersonal and interracial tensions in Rio County, Texas. Sam Deeds is the local sheriff who is called to investigate a 40-year-old skeleton found in the desert....As Sam delves deeper into the town's dark secrets, he begins to learn more about his father, the legendary former sheriff Buddy Deeds, who replaced the corrupt Charlie Wade. While Sam puzzles out the long-past events surrounding the mystery corpse, he also longs to rekindle a romance with his old high-school flame. Sayles' complex characters are brought together as the tightly woven plot finally draws to its dramatic close.")]
[2023-11-03T13:37:57.451+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:37:57.452+0000] {movie_pg_es.py:128} INFO - [{'_index': 'movies', '_id': 'a9d52337-3249-49ae-92b8-65ee9ebaf359', '_source': {'id': 'a9d52337-3249-49ae-92b8-65ee9ebaf359', 'title': 'Star Wars Rebels', 'type': 'movie', 'rating': 8.0, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223819, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223835, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Animation, Family, Fantasy, Mystery, Sci-Fi', 'actors_names': ['Taylor Gray', 'Dave Filoni', 'Freddie Prinze Jr.', 'Vanessa Marshall'], 'actors_ids': ['11819966-b9d1-494d-bafa-9033ddbe3ab4', '32f131ef-cd32-4659-a037-bcff3f12ac0c', '57a4f809-225e-4a8a-a867-0537a085d6c4', '8026ef16-24cf-43a3-be5b-20609a5265ba'], 'writers_names': ['Dave Filoni', 'Carrie Beck', 'Simon Kinberg'], 'writers_ids': ['32f131ef-cd32-4659-a037-bcff3f12ac0c', '6ba834a0-1039-4b5c-ab78-d5f1f18a4e7d', 'a6d0f7e6-450c-4a16-8b9f-1a6d9a1ce837'], 'directors_names': [], 'directors_ids': [], 'description': 'An animated TV series set between the events of Episode III and IV, Star Wars Rebels takes place in a time where the Empire is securing its grip on the galaxy and hunting down the last of the Jedi Knights as a fledgling rebellion against the Empire is taking shape.'}}, {'_index': 'movies', '_id': 'bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', '_source': {'id': 'bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', 'title': 'Lone Star', 'type': 'movie', 'rating': 7.4, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223760, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223776, tzinfo=TzInfo(UTC)), 'genre': 'Drama, Mystery', 'actors_names': ['Stephen J. Lang', 'Chris Cooper', 'Stephen Mendillo', 'Elizabeth Peña'], 'actors_ids': ['4017cda3-0934-41b1-b8e9-0e3fb792d2ce', '9412ef02-5ed1-407b-9420-ead779a4990a', 'b6cbdda5-049b-4cfe-b393-fdca28688022', 'c7d49113-c202-45a8-a267-a8cd61f27543'], 'writers_names': ['John Sayles'], 'writers_ids': ['0031feab-8f53-412a-8f53-47098a60ac73'], 'directors_names': ['John Sayles'], 'directors_ids': ['0031feab-8f53-412a-8f53-47098a60ac73'], 'description': "John Sayles' murder-mystery explores interpersonal and interracial tensions in Rio County, Texas. Sam Deeds is the local sheriff who is called to investigate a 40-year-old skeleton found in the desert....As Sam delves deeper into the town's dark secrets, he begins to learn more about his father, the legendary former sheriff Buddy Deeds, who replaced the corrupt Charlie Wade. While Sam puzzles out the long-past events surrounding the mystery corpse, he also longs to rekindle a romance with his old high-school flame. Sayles' complex characters are brought together as the tightly woven plot finally draws to its dramatic close."}}]
[2023-11-03T13:37:57.459+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:200 duration:0.005s]
[2023-11-03T13:37:57.459+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 129, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 274, in _process_bulk_chunk_success
    raise BulkIndexError(f"{len(errors)} document(s) failed to index.", errors)
elasticsearch.helpers.BulkIndexError: 2 document(s) failed to index.
[2023-11-03T13:37:57.512+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T133646, start_date=20231103T133756, end_date=20231103T133757
[2023-11-03T13:37:57.529+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 145 for task write_to_es (2 document(s) failed to index.; 3192)
[2023-11-03T13:37:57.549+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:37:57.629+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
