[2023-11-03T13:20:47.386+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es manual__2023-11-03T13:20:37.158220+00:00 [queued]>
[2023-11-03T13:20:47.395+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es manual__2023-11-03T13:20:37.158220+00:00 [queued]>
[2023-11-03T13:20:47.395+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:20:47.412+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:20:37.158220+00:00
[2023-11-03T13:20:47.420+0000] {standard_task_runner.py:57} INFO - Started process 2779 to run task
[2023-11-03T13:20:47.423+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'manual__2023-11-03T13:20:37.158220+00:00', '--job-id', '96', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmpsqjybjg7']
[2023-11-03T13:20:47.427+0000] {standard_task_runner.py:85} INFO - Job 96: Subtask write_to_es
[2023-11-03T13:20:47.616+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es manual__2023-11-03T13:20:37.158220+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:20:47.877+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:20:37.158220+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2023-11-03T13:20:37.158220+00:00'
[2023-11-03T13:20:47.943+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='2bfc0f50-7a88-4d4c-bbf8-f839c6150e7e', title='Star Trek: The Original Series', type='movie', rating=8.3, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223185, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223201, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Sci-Fi', actors_names=['Leonard Nimoy', 'DeForest Kelley', 'William Shatner', 'Nichelle Nichols'], actors_ids=['5a3d0299-2df2-4070-9fda-65ff4dfa863c', '836bb95b-6db8-4418-a110-f41663b1c025', '9758b894-57d7-465d-b657-c5803dd5b7f7', 'a76a7d73-4c57-49b8-a7e8-1c5c1e3452fb'], writers_names=['Gene Roddenberry'], writers_ids=['6960e2ca-889f-41f5-b728-1e7313e54d6c'], directors_names=[], directors_ids=[], description='The adventures of the USS Enterprise, representing the United Federation of Planets on a five-year mission in outer space to explore new worlds, seek new life and new civilizations, and to boldly go where no one has gone before. The Enterprise is commanded by handsome and brash Captain James T. Kirk. His First Officer and best friend is Mr. Spock from the planet Vulcan, and Kirk\'s Medical Officer is Dr. Leonard "Bones" McCoy. With a crew of approximately 430, the Enterprise battles aliens, megalomaniacal computers, time paradoxes, psychotic murderers, and even Khan!'), FilmWorkES(id='50d842be-bcda-401e-90de-b06929611ce0', title='Star Trek: Nemesis', type='movie', rating=6.4, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223132, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223149, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Sci-Fi, Thriller', actors_names=['Patrick Stewart', 'Jonathan Frakes', 'Brent Spiner', 'LeVar Burton'], actors_ids=['57a471b1-09dc-48fd-ba8a-1211015a0110', '5bddea2c-8609-499a-a444-77e0142743c0', '972c86a5-16f4-432b-b9b3-54965291ddb0', 'fc9f27d2-aaee-46e6-b263-40ec8d2dd355'], writers_names=['John Logan', 'Gene Roddenberry', 'Rick Berman', 'Brent Spiner'], writers_ids=['1f6ad693-a134-44f1-a0a6-71e4c0dec31a', '6960e2ca-889f-41f5-b728-1e7313e54d6c', '88a99b4d-4d06-4754-b06c-93217cf53244', '972c86a5-16f4-432b-b9b3-54965291ddb0'], directors_names=['Stuart Baird'], directors_ids=['a37e91d0-3c82-43f3-8517-68699ee134d6'], description='After a joyous wedding between William Riker and Deanna Troi, Captain Picard and the Enterprise crew stumble upon a mysterious signal which results in it being a prototype android who is the twin to Data. Then the Enterprise is invited to Romulus to negotiate peace with the Romulans by their new Praetor named Shinzon. However, Shinzon is revealed to be a clone of Picard who was raised on Remus, a slave planet to the Romulans. Later on, Picard discovers that this peace treaty was nothing more than a set-up due to the fact that Shinzon needs Picard in order to survive. But little do the Enterprise crew know that Shinzon also plans to do away with the Federation by unleashing a weapon that could destroy a whole planet.')]
[2023-11-03T13:20:47.944+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:20:47.953+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:400 duration:0.007s]
[2023-11-03T13:20:47.954+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 126, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 291, in _process_bulk_chunk_error
    raise error
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 339, in _process_bulk_chunk
    resp = client.bulk(*args, operations=bulk_actions, **kwargs)  # type: ignore[arg-type]
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/utils.py", line 414, in wrapped
    return api(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/__init__.py", line 704, in bulk
    return self.perform_request(  # type: ignore[return-value]
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/_base.py", line 320, in perform_request
    raise HTTP_EXCEPTIONS.get(meta.status, ApiError)(
elasticsearch.BadRequestError: BadRequestError(400, 'action_request_validation_exception', 'Validation Failed: 1: index is missing;2: index is missing;')
[2023-11-03T13:20:48.005+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T132037, start_date=20231103T132047, end_date=20231103T132048
[2023-11-03T13:20:48.021+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 96 for task write_to_es (BadRequestError(400, 'action_request_validation_exception', 'Validation Failed: 1: index is missing;2: index is missing;'); 2779)
[2023-11-03T13:20:48.037+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:20:48.109+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
