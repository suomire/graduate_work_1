[2023-11-03T13:23:18.406+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:22:10.677373+00:00 [queued]>
[2023-11-03T13:23:18.416+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:22:10.677373+00:00 [queued]>
[2023-11-03T13:23:18.416+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:23:18.434+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:22:10.677373+00:00
[2023-11-03T13:23:18.440+0000] {standard_task_runner.py:57} INFO - Started process 2859 to run task
[2023-11-03T13:23:18.443+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:22:10.677373+00:00', '--job-id', '109', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmp3alv4__m']
[2023-11-03T13:23:18.447+0000] {standard_task_runner.py:85} INFO - Job 109: Subtask write_to_es
[2023-11-03T13:23:18.607+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:22:10.677373+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:23:18.846+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:22:10.677373+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:22:10.677373+00:00'
[2023-11-03T13:23:18.905+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='511b8ae8-f59d-450e-b9a2-22aabba2693b', title='Star Trek VI: The Undiscovered Country', type='movie', rating=7.2, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223292, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223308, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Sci-Fi, Thriller', actors_names=['Leonard Nimoy', 'James Doohan', 'DeForest Kelley', 'William Shatner'], actors_ids=['5a3d0299-2df2-4070-9fda-65ff4dfa863c', '807ce9c3-6294-485c-803a-1975066f239f', '836bb95b-6db8-4418-a110-f41663b1c025', '9758b894-57d7-465d-b657-c5803dd5b7f7'], writers_names=['Denny Martin Flinn', 'Lawrence Konner', 'Leonard Nimoy', 'Gene Roddenberry', 'Mark Rosenthal', 'Nicholas Meyer'], writers_ids=['1749841f-0569-49bb-96ce-3f9dd51b42e2', '59674337-e77d-422b-967c-aa01017af7c3', '5a3d0299-2df2-4070-9fda-65ff4dfa863c', '6960e2ca-889f-41f5-b728-1e7313e54d6c', 'b5fa51d6-4753-4b64-819c-2de16af5c057', 'c883c2c6-d7a4-4001-8084-e2851904e91a'], directors_names=['Nicholas Meyer'], directors_ids=['c883c2c6-d7a4-4001-8084-e2851904e91a'], description="After an explosion on their moon, the Klingons have an estimated 50 years before their ozone layer is completely depleted, and they all die. They have only one choice - to make peace with the Federation, which will mean an end to 70 years of conflict. Captain James T. Kirk and crew are called upon to help in the negotiations because of their experience with the Klingons. Peace talks don't quite proceed, and Kirk and McCoy are convicted of assassinating the Klingon High Chancellor, and imprisoned on Rura Penthe, a snowy hard-labor prison camp. Will they manage to escape? And will there ever be peace with the Klingons?"), FilmWorkES(id='9d284e83-21f0-4073-aac0-4abee51193d8', title='Star Trek: Insurrection', type='movie', rating=6.4, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223239, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223256, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Sci-Fi, Thriller', actors_names=['Patrick Stewart', 'Jonathan Frakes', 'Brent Spiner', 'LeVar Burton'], actors_ids=['57a471b1-09dc-48fd-ba8a-1211015a0110', '5bddea2c-8609-499a-a444-77e0142743c0', '972c86a5-16f4-432b-b9b3-54965291ddb0', 'fc9f27d2-aaee-46e6-b263-40ec8d2dd355'], writers_names=['Gene Roddenberry', 'Rick Berman', 'Michael Piller'], writers_ids=['6960e2ca-889f-41f5-b728-1e7313e54d6c', '88a99b4d-4d06-4754-b06c-93217cf53244', 'd67afc96-b9ed-4c91-9507-ffc2018c58d7'], directors_names=['Jonathan Frakes'], directors_ids=['5bddea2c-8609-499a-a444-77e0142743c0'], description="While on a mission to observe the peaceful Ba'ku race, Lt. Commander Data suddenly behaves as if having to fear for his existence. The immortal Ba'ku, whose planet offers regenerative radiation and therefore incredible lifespans, live in harmony with nature and reject advanced technology. Their planet and their culture is secretly researched by the Federation associated with an alien race called the Son'a. But the Son'a intend to abduct the Ba'ku in order to take the planet for themselves and for the Starfleet officials who all would like to regenerate their bodies. But they did not think of the loyalty of Captain Jean-Luc Picard and the crew of the Enterprise-E to the Prime Directive.")]
[2023-11-03T13:23:18.905+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:23:18.920+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:400 duration:0.013s]
[2023-11-03T13:23:18.921+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 126, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 291, in _process_bulk_chunk_error
    raise error
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 339, in _process_bulk_chunk
    resp = client.bulk(*args, operations=bulk_actions, **kwargs)  # type: ignore[arg-type]
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/utils.py", line 414, in wrapped
    return api(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/__init__.py", line 704, in bulk
    return self.perform_request(  # type: ignore[return-value]
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/_sync/client/_base.py", line 320, in perform_request
    raise HTTP_EXCEPTIONS.get(meta.status, ApiError)(
elasticsearch.BadRequestError: BadRequestError(400, 'action_request_validation_exception', 'Validation Failed: 1: index is missing;2: index is missing;')
[2023-11-03T13:23:18.972+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T132210, start_date=20231103T132318, end_date=20231103T132318
[2023-11-03T13:23:18.985+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 109 for task write_to_es (BadRequestError(400, 'action_request_validation_exception', 'Validation Failed: 1: index is missing;2: index is missing;'); 2859)
[2023-11-03T13:23:19.056+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:23:19.125+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
