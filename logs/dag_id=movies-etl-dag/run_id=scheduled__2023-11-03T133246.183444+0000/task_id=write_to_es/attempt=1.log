[2023-11-03T13:33:54.447+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:32:46.183444+00:00 [queued]>
[2023-11-03T13:33:54.460+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:32:46.183444+00:00 [queued]>
[2023-11-03T13:33:54.460+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:33:54.485+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:32:46.183444+00:00
[2023-11-03T13:33:54.493+0000] {standard_task_runner.py:57} INFO - Started process 3092 to run task
[2023-11-03T13:33:54.497+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:32:46.183444+00:00', '--job-id', '133', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmp095wly54']
[2023-11-03T13:33:54.500+0000] {standard_task_runner.py:85} INFO - Job 133: Subtask write_to_es
[2023-11-03T13:33:54.719+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:32:46.183444+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:33:54.979+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:32:46.183444+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:32:46.183444+00:00'
[2023-11-03T13:33:55.036+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='47050db6-580f-493c-a007-a11c8768ce1b', title='Star Trek: Enterprise', type='movie', rating=7.5, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Drama, Sci-Fi', actors_names=['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], actors_ids=['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], writers_names=['Rick Berman', 'Brannon Braga'], writers_ids=['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], directors_names=[], directors_ids=[], description="The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."), FilmWorkES(id='a144d250-6667-47e4-94bd-0ee59c0dc05f', title='Star Trek: Deep Space Nine', type='movie', rating=7.9, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223554, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223571, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Drama, Sci-Fi', actors_names=['Avery Brooks', 'Cirroc Lofton', 'Rene Auberjonois', 'Alexander Siddig'], actors_ids=['511b9add-1f0c-4b5f-be96-14dc569ffb06', '7970a901-e0ee-4a71-a2ea-9c964dcffc29', '81b3b0d6-81d9-45aa-a90b-614978cf7b29', 'd3377a4d-eee3-4fba-adca-fb60170afbeb'], writers_names=['Rick Berman', 'Michael Piller'], writers_ids=['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67afc96-b9ed-4c91-9507-ffc2018c58d7'], directors_names=[], directors_ids=[], description="The stable wormhole discovered by the Deep Space Nine crew is known to the Bajoran people as the Celestial Temple of their Prophets. Sisko, as discoverer of the wormhole and its inhabitants, is therefore the Emissary of Bajoran prophesy. The wormhole's other end is in the Gamma Quadrant, halfway around the galaxy from Bajor. That section of space is dominated by the malevolent Dominion. The Dominion is led by the Changelings, the race of shapeshifters to which Odo belongs. As of the beginning of the sixth season, Cardassia has joined the Dominion, and together they are waging war on the Federation and their Klingon allies. The war is quickly becoming the most costly war ever for the Federation, and the Deep Space Nine crew must fight to protect their way of life.")]
[2023-11-03T13:33:55.036+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:33:55.037+0000] {movie_pg_es.py:122} INFO - movies
[2023-11-03T13:33:55.038+0000] {movie_pg_es.py:123} INFO - 47050db6-580f-493c-a007-a11c8768ce1b
[2023-11-03T13:33:55.038+0000] {movie_pg_es.py:127} INFO - 
[2023-11-03T13:33:55.039+0000] {movie_pg_es.py:133} INFO - {'_index': 'movies', '_id': '47050db6-580f-493c-a007-a11c8768ce1b', '_source': {'id': '47050db6-580f-493c-a007-a11c8768ce1b', 'title': 'Star Trek: Enterprise', 'type': 'movie', 'rating': 7.5, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], 'actors_ids': ['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], 'writers_names': ['Rick Berman', 'Brannon Braga'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], 'directors_names': [], 'directors_ids': [], 'description': "The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."}}
[2023-11-03T13:33:55.039+0000] {movie_pg_es.py:122} INFO - movies
[2023-11-03T13:33:55.039+0000] {movie_pg_es.py:123} INFO - a144d250-6667-47e4-94bd-0ee59c0dc05f
[2023-11-03T13:33:55.040+0000] {movie_pg_es.py:127} INFO - 
[2023-11-03T13:33:55.040+0000] {movie_pg_es.py:133} INFO - {'_index': 'movies', '_id': 'a144d250-6667-47e4-94bd-0ee59c0dc05f', '_source': {'id': 'a144d250-6667-47e4-94bd-0ee59c0dc05f', 'title': 'Star Trek: Deep Space Nine', 'type': 'movie', 'rating': 7.9, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223554, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223571, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Avery Brooks', 'Cirroc Lofton', 'Rene Auberjonois', 'Alexander Siddig'], 'actors_ids': ['511b9add-1f0c-4b5f-be96-14dc569ffb06', '7970a901-e0ee-4a71-a2ea-9c964dcffc29', '81b3b0d6-81d9-45aa-a90b-614978cf7b29', 'd3377a4d-eee3-4fba-adca-fb60170afbeb'], 'writers_names': ['Rick Berman', 'Michael Piller'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67afc96-b9ed-4c91-9507-ffc2018c58d7'], 'directors_names': [], 'directors_ids': [], 'description': "The stable wormhole discovered by the Deep Space Nine crew is known to the Bajoran people as the Celestial Temple of their Prophets. Sisko, as discoverer of the wormhole and its inhabitants, is therefore the Emissary of Bajoran prophesy. The wormhole's other end is in the Gamma Quadrant, halfway around the galaxy from Bajor. That section of space is dominated by the malevolent Dominion. The Dominion is led by the Changelings, the race of shapeshifters to which Odo belongs. As of the beginning of the sixth season, Cardassia has joined the Dominion, and together they are waging war on the Federation and their Klingon allies. The war is quickly becoming the most costly war ever for the Federation, and the Deep Space Nine crew must fight to protect their way of life."}}
[2023-11-03T13:33:55.040+0000] {movie_pg_es.py:142} INFO - [{'_index': 'movies', '_id': '47050db6-580f-493c-a007-a11c8768ce1b', '_source': {'id': '47050db6-580f-493c-a007-a11c8768ce1b', 'title': 'Star Trek: Enterprise', 'type': 'movie', 'rating': 7.5, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223606, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223623, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Scott Bakula', 'John Billingsley', 'Dominic Keating', 'Jolene Blalock'], 'actors_ids': ['160a18f5-88b0-40eb-ac8f-545c4e35a723', '3d6d8482-7a99-44cf-af06-3921e8bd5cca', '643096b7-e25e-40c4-a206-3f233aa9be43', 'ba333c8b-9b0b-4390-99c0-05a8117f7f68'], 'writers_names': ['Rick Berman', 'Brannon Braga'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67d5cb8-4541-4b20-89be-4100ba95e615'], 'directors_names': [], 'directors_ids': [], 'description': "The year is 2151. Earth has spent the last 88 years since learning how to travel faster than the speed of light studying under the wisdom of their alien ally called the 'Vulcans'. Now, the first crew of human explorers sets out into deep space on a ship called the 'Enterprise' to see what is beyond our solar system."}}, {'_index': 'movies', '_id': 'a144d250-6667-47e4-94bd-0ee59c0dc05f', '_source': {'id': 'a144d250-6667-47e4-94bd-0ee59c0dc05f', 'title': 'Star Trek: Deep Space Nine', 'type': 'movie', 'rating': 7.9, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223554, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223571, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Avery Brooks', 'Cirroc Lofton', 'Rene Auberjonois', 'Alexander Siddig'], 'actors_ids': ['511b9add-1f0c-4b5f-be96-14dc569ffb06', '7970a901-e0ee-4a71-a2ea-9c964dcffc29', '81b3b0d6-81d9-45aa-a90b-614978cf7b29', 'd3377a4d-eee3-4fba-adca-fb60170afbeb'], 'writers_names': ['Rick Berman', 'Michael Piller'], 'writers_ids': ['88a99b4d-4d06-4754-b06c-93217cf53244', 'd67afc96-b9ed-4c91-9507-ffc2018c58d7'], 'directors_names': [], 'directors_ids': [], 'description': "The stable wormhole discovered by the Deep Space Nine crew is known to the Bajoran people as the Celestial Temple of their Prophets. Sisko, as discoverer of the wormhole and its inhabitants, is therefore the Emissary of Bajoran prophesy. The wormhole's other end is in the Gamma Quadrant, halfway around the galaxy from Bajor. That section of space is dominated by the malevolent Dominion. The Dominion is led by the Changelings, the race of shapeshifters to which Odo belongs. As of the beginning of the sixth season, Cardassia has joined the Dominion, and together they are waging war on the Federation and their Klingon allies. The war is quickly becoming the most costly war ever for the Federation, and the Deep Space Nine crew must fight to protect their way of life."}}]
[2023-11-03T13:33:55.047+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:200 duration:0.006s]
[2023-11-03T13:33:55.048+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 143, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 274, in _process_bulk_chunk_success
    raise BulkIndexError(f"{len(errors)} document(s) failed to index.", errors)
elasticsearch.helpers.BulkIndexError: 2 document(s) failed to index.
[2023-11-03T13:33:55.117+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T133246, start_date=20231103T133354, end_date=20231103T133355
[2023-11-03T13:33:55.137+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 133 for task write_to_es (2 document(s) failed to index.; 3092)
[2023-11-03T13:33:55.151+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:33:55.219+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
