[2023-11-03T13:36:55.266+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:35:46.183444+00:00 [queued]>
[2023-11-03T13:36:55.275+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:35:46.183444+00:00 [queued]>
[2023-11-03T13:36:55.276+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:36:55.292+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:35:46.183444+00:00
[2023-11-03T13:36:55.301+0000] {standard_task_runner.py:57} INFO - Started process 3167 to run task
[2023-11-03T13:36:55.305+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:35:46.183444+00:00', '--job-id', '142', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmp4bijz3pz']
[2023-11-03T13:36:55.309+0000] {standard_task_runner.py:85} INFO - Job 142: Subtask write_to_es
[2023-11-03T13:36:55.564+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:35:46.183444+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:36:55.798+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:35:46.183444+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:35:46.183444+00:00'
[2023-11-03T13:36:55.850+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', title='Lone Star', type='movie', rating=7.4, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223760, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223776, tzinfo=TzInfo(UTC)), genre='Drama, Mystery', actors_names=['Stephen J. Lang', 'Chris Cooper', 'Stephen Mendillo', 'Elizabeth Peña'], actors_ids=['4017cda3-0934-41b1-b8e9-0e3fb792d2ce', '9412ef02-5ed1-407b-9420-ead779a4990a', 'b6cbdda5-049b-4cfe-b393-fdca28688022', 'c7d49113-c202-45a8-a267-a8cd61f27543'], writers_names=['John Sayles'], writers_ids=['0031feab-8f53-412a-8f53-47098a60ac73'], directors_names=['John Sayles'], directors_ids=['0031feab-8f53-412a-8f53-47098a60ac73'], description="John Sayles' murder-mystery explores interpersonal and interracial tensions in Rio County, Texas. Sam Deeds is the local sheriff who is called to investigate a 40-year-old skeleton found in the desert....As Sam delves deeper into the town's dark secrets, he begins to learn more about his father, the legendary former sheriff Buddy Deeds, who replaced the corrupt Charlie Wade. While Sam puzzles out the long-past events surrounding the mystery corpse, he also longs to rekindle a romance with his old high-school flame. Sayles' complex characters are brought together as the tightly woven plot finally draws to its dramatic close."), FilmWorkES(id='cc397479-a5f8-488f-bd7f-7fbb94ec6e18', title='Star Trek: Picard', type='movie', rating=7.7, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223710, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223726, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Drama, Sci-Fi', actors_names=['Isa Briones', 'Alison Pill', 'Patrick Stewart', 'Michelle Hurd'], actors_ids=['0c7a51eb-1a64-4787-a042-3226e37dc512', '1a93d567-f525-4fcf-a9b0-67f1a3f56eb3', '57a471b1-09dc-48fd-ba8a-1211015a0110', '605f31b6-6929-46b5-8e90-b926423c9113'], writers_names=['Akiva Goldsman', 'Alex Kurtzman', 'Kirsten Beyer', 'Michael Chabon'], writers_ids=['772faacb-5d57-4e72-b44f-01fde7f08c1a', '82b7dffe-6254-4598-b6ef-5be747193946', '8a9cb7b2-dd61-4f7f-94ec-61aac18ed5d9', 'c5affe3b-e9f2-4fdb-a5ee-018dd751d3f4'], directors_names=[], directors_ids=[], description='Follow-up series to Star Trek: The Next Generation (1987) and Star Trek: Nemesis (2002) that centers on Jean-Luc Picard (Sir Patrick Stewart) in the next chapter of his life.')]
[2023-11-03T13:36:55.851+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:36:55.851+0000] {movie_pg_es.py:128} INFO - [{'_index': 'movies', '_id': 'bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', '_source': {'id': 'bfe61bd9-5dfd-41ca-80ae-8eca998bc29d', 'title': 'Lone Star', 'type': 'movie', 'rating': 7.4, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223760, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223776, tzinfo=TzInfo(UTC)), 'genre': 'Drama, Mystery', 'actors_names': ['Stephen J. Lang', 'Chris Cooper', 'Stephen Mendillo', 'Elizabeth Peña'], 'actors_ids': ['4017cda3-0934-41b1-b8e9-0e3fb792d2ce', '9412ef02-5ed1-407b-9420-ead779a4990a', 'b6cbdda5-049b-4cfe-b393-fdca28688022', 'c7d49113-c202-45a8-a267-a8cd61f27543'], 'writers_names': ['John Sayles'], 'writers_ids': ['0031feab-8f53-412a-8f53-47098a60ac73'], 'directors_names': ['John Sayles'], 'directors_ids': ['0031feab-8f53-412a-8f53-47098a60ac73'], 'description': "John Sayles' murder-mystery explores interpersonal and interracial tensions in Rio County, Texas. Sam Deeds is the local sheriff who is called to investigate a 40-year-old skeleton found in the desert....As Sam delves deeper into the town's dark secrets, he begins to learn more about his father, the legendary former sheriff Buddy Deeds, who replaced the corrupt Charlie Wade. While Sam puzzles out the long-past events surrounding the mystery corpse, he also longs to rekindle a romance with his old high-school flame. Sayles' complex characters are brought together as the tightly woven plot finally draws to its dramatic close."}}, {'_index': 'movies', '_id': 'cc397479-a5f8-488f-bd7f-7fbb94ec6e18', '_source': {'id': 'cc397479-a5f8-488f-bd7f-7fbb94ec6e18', 'title': 'Star Trek: Picard', 'type': 'movie', 'rating': 7.7, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223710, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223726, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Isa Briones', 'Alison Pill', 'Patrick Stewart', 'Michelle Hurd'], 'actors_ids': ['0c7a51eb-1a64-4787-a042-3226e37dc512', '1a93d567-f525-4fcf-a9b0-67f1a3f56eb3', '57a471b1-09dc-48fd-ba8a-1211015a0110', '605f31b6-6929-46b5-8e90-b926423c9113'], 'writers_names': ['Akiva Goldsman', 'Alex Kurtzman', 'Kirsten Beyer', 'Michael Chabon'], 'writers_ids': ['772faacb-5d57-4e72-b44f-01fde7f08c1a', '82b7dffe-6254-4598-b6ef-5be747193946', '8a9cb7b2-dd61-4f7f-94ec-61aac18ed5d9', 'c5affe3b-e9f2-4fdb-a5ee-018dd751d3f4'], 'directors_names': [], 'directors_ids': [], 'description': 'Follow-up series to Star Trek: The Next Generation (1987) and Star Trek: Nemesis (2002) that centers on Jean-Luc Picard (Sir Patrick Stewart) in the next chapter of his life.'}}]
[2023-11-03T13:36:55.858+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:200 duration:0.005s]
[2023-11-03T13:36:55.859+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 129, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 274, in _process_bulk_chunk_success
    raise BulkIndexError(f"{len(errors)} document(s) failed to index.", errors)
elasticsearch.helpers.BulkIndexError: 2 document(s) failed to index.
[2023-11-03T13:36:55.909+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T133546, start_date=20231103T133655, end_date=20231103T133655
[2023-11-03T13:36:55.925+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 142 for task write_to_es (2 document(s) failed to index.; 3167)
[2023-11-03T13:36:55.958+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:36:56.035+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
