[2023-11-03T13:35:54.370+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:34:46.183444+00:00 [queued]>
[2023-11-03T13:35:54.377+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:34:46.183444+00:00 [queued]>
[2023-11-03T13:35:54.378+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 1
[2023-11-03T13:35:54.399+0000] {taskinstance.py:1380} INFO - Executing <Task(PythonOperator): write_to_es> on 2023-11-03 13:34:46.183444+00:00
[2023-11-03T13:35:54.406+0000] {standard_task_runner.py:57} INFO - Started process 3142 to run task
[2023-11-03T13:35:54.410+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'movies-etl-dag', 'write_to_es', 'scheduled__2023-11-03T13:34:46.183444+00:00', '--job-id', '139', '--raw', '--subdir', 'DAGS_FOLDER/movie_pg_es.py', '--cfg-path', '/tmp/tmpq99q20vg']
[2023-11-03T13:35:54.413+0000] {standard_task_runner.py:85} INFO - Job 139: Subtask write_to_es
[2023-11-03T13:35:54.576+0000] {task_command.py:415} INFO - Running <TaskInstance: movies-etl-dag.write_to_es scheduled__2023-11-03T13:34:46.183444+00:00 [running]> on host e468bf2dfd15
[2023-11-03T13:35:54.813+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='movies-etl-dag' AIRFLOW_CTX_TASK_ID='write_to_es' AIRFLOW_CTX_EXECUTION_DATE='2023-11-03T13:34:46.183444+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2023-11-03T13:34:46.183444+00:00'
[2023-11-03T13:35:54.865+0000] {movie_pg_es.py:118} INFO - [FilmWorkES(id='496f504e-20fa-4dfd-b4cb-c7c4ef636e07', title='Rock Star', type='movie', rating=6.3, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223658, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223674, tzinfo=TzInfo(UTC)), genre='Drama, Music', actors_names=['Mark Wahlberg', 'Jennifer Aniston', 'Jason Bonham', 'Dominic West'], actors_ids=['25423597-4cb0-4e9f-a9aa-86b1fd3aadee', '9ea3f318-841d-44fc-afba-21d154eb99be', 'b2362da9-6c24-422c-8085-01851ba79297', 'fc616cc0-3961-44ff-ac27-9bfdcc28917f'], writers_names=['John Stockwell'], writers_ids=['8c0eb98b-4020-4012-914e-533939ddafde'], directors_names=['Stephen Herek'], directors_ids=['eda15243-9373-412b-8010-1cc70cacebf5'], description="Chris Cole was born to rock. His longtime girlfriend Emily believes his talent could take him all the way - but Chris worships at the altar of Bobby Beers, the fiery frontman for heavy metal legends Steel Dragon. By day, Chris still lives at home with his parents and spends his days repairing copy machines. But when Chris takes the stage, fronting Pennsylvania's premiere Steel Dragon tribute band, all of that disappears. Chris Cole is Bobby Beers - mesmerizing audiences with his perfect imitation of Beers' electrifying vocals. The night his bandmates boot him out of the group, Chris is devastated - until an unexpected phone call changes his life forever: He, Chris Cole, has been tapped to replace Bobby Beers as the lead singer of Steel Dragon. In an instant, Chris rockets to the dizzying heights of sudden stardom, rising from devotee to icon, from rock fan to rock god - the wanna-be who got to be. So what happens when an average guy gets everything he wants - and discovers it's not enough?"), FilmWorkES(id='cc397479-a5f8-488f-bd7f-7fbb94ec6e18', title='Star Trek: Picard', type='movie', rating=7.7, created_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223710, tzinfo=TzInfo(UTC)), updated_at=datetime.datetime(2021, 6, 16, 20, 14, 9, 223726, tzinfo=TzInfo(UTC)), genre='Action, Adventure, Drama, Sci-Fi', actors_names=['Isa Briones', 'Alison Pill', 'Patrick Stewart', 'Michelle Hurd'], actors_ids=['0c7a51eb-1a64-4787-a042-3226e37dc512', '1a93d567-f525-4fcf-a9b0-67f1a3f56eb3', '57a471b1-09dc-48fd-ba8a-1211015a0110', '605f31b6-6929-46b5-8e90-b926423c9113'], writers_names=['Akiva Goldsman', 'Alex Kurtzman', 'Kirsten Beyer', 'Michael Chabon'], writers_ids=['772faacb-5d57-4e72-b44f-01fde7f08c1a', '82b7dffe-6254-4598-b6ef-5be747193946', '8a9cb7b2-dd61-4f7f-94ec-61aac18ed5d9', 'c5affe3b-e9f2-4fdb-a5ee-018dd751d3f4'], directors_names=[], directors_ids=[], description='Follow-up series to Star Trek: The Next Generation (1987) and Star Trek: Nemesis (2002) that centers on Jean-Luc Picard (Sir Patrick Stewart) in the next chapter of his life.')]
[2023-11-03T13:35:54.866+0000] {movie_pg_es.py:119} INFO - Processing 2 movie:
[2023-11-03T13:35:54.867+0000] {movie_pg_es.py:128} INFO - [{'_index': 'movies', '_id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', '_source': {'id': '496f504e-20fa-4dfd-b4cb-c7c4ef636e07', 'title': 'Rock Star', 'type': 'movie', 'rating': 6.3, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223658, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223674, tzinfo=TzInfo(UTC)), 'genre': 'Drama, Music', 'actors_names': ['Mark Wahlberg', 'Jennifer Aniston', 'Jason Bonham', 'Dominic West'], 'actors_ids': ['25423597-4cb0-4e9f-a9aa-86b1fd3aadee', '9ea3f318-841d-44fc-afba-21d154eb99be', 'b2362da9-6c24-422c-8085-01851ba79297', 'fc616cc0-3961-44ff-ac27-9bfdcc28917f'], 'writers_names': ['John Stockwell'], 'writers_ids': ['8c0eb98b-4020-4012-914e-533939ddafde'], 'directors_names': ['Stephen Herek'], 'directors_ids': ['eda15243-9373-412b-8010-1cc70cacebf5'], 'description': "Chris Cole was born to rock. His longtime girlfriend Emily believes his talent could take him all the way - but Chris worships at the altar of Bobby Beers, the fiery frontman for heavy metal legends Steel Dragon. By day, Chris still lives at home with his parents and spends his days repairing copy machines. But when Chris takes the stage, fronting Pennsylvania's premiere Steel Dragon tribute band, all of that disappears. Chris Cole is Bobby Beers - mesmerizing audiences with his perfect imitation of Beers' electrifying vocals. The night his bandmates boot him out of the group, Chris is devastated - until an unexpected phone call changes his life forever: He, Chris Cole, has been tapped to replace Bobby Beers as the lead singer of Steel Dragon. In an instant, Chris rockets to the dizzying heights of sudden stardom, rising from devotee to icon, from rock fan to rock god - the wanna-be who got to be. So what happens when an average guy gets everything he wants - and discovers it's not enough?"}}, {'_index': 'movies', '_id': 'cc397479-a5f8-488f-bd7f-7fbb94ec6e18', '_source': {'id': 'cc397479-a5f8-488f-bd7f-7fbb94ec6e18', 'title': 'Star Trek: Picard', 'type': 'movie', 'rating': 7.7, 'created_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223710, tzinfo=TzInfo(UTC)), 'updated_at': datetime.datetime(2021, 6, 16, 20, 14, 9, 223726, tzinfo=TzInfo(UTC)), 'genre': 'Action, Adventure, Drama, Sci-Fi', 'actors_names': ['Isa Briones', 'Alison Pill', 'Patrick Stewart', 'Michelle Hurd'], 'actors_ids': ['0c7a51eb-1a64-4787-a042-3226e37dc512', '1a93d567-f525-4fcf-a9b0-67f1a3f56eb3', '57a471b1-09dc-48fd-ba8a-1211015a0110', '605f31b6-6929-46b5-8e90-b926423c9113'], 'writers_names': ['Akiva Goldsman', 'Alex Kurtzman', 'Kirsten Beyer', 'Michael Chabon'], 'writers_ids': ['772faacb-5d57-4e72-b44f-01fde7f08c1a', '82b7dffe-6254-4598-b6ef-5be747193946', '8a9cb7b2-dd61-4f7f-94ec-61aac18ed5d9', 'c5affe3b-e9f2-4fdb-a5ee-018dd751d3f4'], 'directors_names': [], 'directors_ids': [], 'description': 'Follow-up series to Star Trek: The Next Generation (1987) and Star Trek: Nemesis (2002) that centers on Jean-Luc Picard (Sir Patrick Stewart) in the next chapter of his life.'}}]
[2023-11-03T13:35:54.876+0000] {_transport.py:336} INFO - PUT http://movies_es_db:9200/_bulk [status:200 duration:0.007s]
[2023-11-03T13:35:54.877+0000] {taskinstance.py:1935} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/movie_pg_es.py", line 129, in write_to_es
    helpers.bulk(es_conn, actions)
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 521, in bulk
    for ok, item in streaming_bulk(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 436, in streaming_bulk
    for data, (ok, info) in zip(
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 355, in _process_bulk_chunk
    yield from gen
  File "/home/airflow/.local/lib/python3.8/site-packages/elasticsearch/helpers/actions.py", line 274, in _process_bulk_chunk_success
    raise BulkIndexError(f"{len(errors)} document(s) failed to index.", errors)
elasticsearch.helpers.BulkIndexError: 2 document(s) failed to index.
[2023-11-03T13:35:54.922+0000] {taskinstance.py:1398} INFO - Marking task as FAILED. dag_id=movies-etl-dag, task_id=write_to_es, execution_date=20231103T133446, start_date=20231103T133554, end_date=20231103T133554
[2023-11-03T13:35:54.936+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 139 for task write_to_es (2 document(s) failed to index.; 3142)
[2023-11-03T13:35:54.983+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-11-03T13:35:55.047+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
